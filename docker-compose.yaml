version: "3.9"
services:
  esphome:
    container_name: esphome
    image: ghcr.io/esphome/esphome
    ports:
      - 6052:6052
    volumes:
      - ./esphome:/config
#    devices:
#      - /dev/ttyUSB0:/dev/ttyUSB0
     # - /dev/ttyUSB0:/dev/ttyUSB1
    # network_mode: host
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.esphome.rule=Host(`esphome.lan`)"
      - "traefik.http.services.esphome.loadbalancer.server.port=6052"

    networks:
      - proxy


  # homer:
  #   container_name: homer
  #   image: b4bz/homer:latest
  #   ports:
  #     - 8080:8080
  #   volumes:
  #     - homer_data:/www/assets
  #   network_mode: host
  #   restart: always
  #   user: 1000:1000 
  #   environment:
  #     - INIT_ASSETS=1
  # home-assistant:
  #   container_name: home-assistant
  #   image: homeassistant/home-assistant:latest
  #   ports:
  #     - 8123:8123
  #   volumes:
  #     - ha_config:/config
  #     - /etc/localtime:/etc/localtime:ro
    #check USB devices location before deploy: ls -l /dev/serial/by-id  
    #devices:
     # - /dev/ttyUSB0:/dev/ttyUSB0
    #   - /dev/ttyUSB0:/dev/ttyUSB1
    #  - /dev/ttyACM0:/dev/ttyACM0
    #   - /dev/ttyACM1:/dev/ttyACM1
    # network_mode: host
    # restart: always
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    ports:
      - 1201:3000
    volumes:
      - ./homepage/config:/app/config # Make sure your local config directory exists
      - ./homepage/images:/app/public/images
      - ./homepage/icons:/app/public/icons
      - /var/run/docker.sock:/var/run/docker.sock # (optional) For docker integrations
    environment:
      - TZ=Europe/Amsterdam
      - HOMEPAGE_ALLOWED_HOSTS=192.168.178.127:1201,localhost,127.0.0.1
  komodo-agent:
    image: ghcr.io/moghtech/komodo-periphery:latest
    container_name: komodo-agent
    restart: unless-stopped
    ports:
      - "8120:8120"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /proc:/proc
      - ${PERIPHERY_ROOT_DIRECTORY:-/etc/komodo}:${PERIPHERY_ROOT_DIRECTORY:-/etc/komodo}
    environment:
      # Optioneel: geef een naam of beschrijving van de host door
      KOMODO_AGENT_NAME: dockerserver2
      PERIPHERY_ROOT_DIRECTORY: ${PERIPHERY_ROOT_DIRECTORY:-/etc/komodo}
  traefik:
    image: traefik:v3.1
    container_name: traefik
    restart: always
    command:
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--api.insecure=true"
    ports:
      - 80:80       # HTTP
      # - "443:443"   # HTTPS (optioneel, als je later TLS toevoegt)
      - 8080:8080 #dashboard
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./traefik/traefik.yaml:/traefik.yml:ro
    networks:
      - proxy
  # volume_sharer:
  #   container_name: volume_sharer
  #   image: gdiepen/volume-sharer
  #   volumes:
  #     - /var/lib/docker/volumes:/docker_volumes
  #     - /var/run/docker.sock:/var/run/docker.sock
  #   ports:
  #     - 139:139
  #     - 445:445
  #   network_mode: host
  #   restart: always
  # syncthing:
  #   container_name: syncthing
  #   image: ghcr.io/linuxserver/syncthing
  #   volumes:
  #     - syncthing_config:/config
  #     - ha_config:/syncthing/ha
  #     - esphome_config:/syncthing/esphome
  #   ports:
  #     - 8384:8384
  #     - 22000:22000
  #     - 21027:21027
  #   restart: always
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #     - TZ=Europe/Amsterdam

# volumes:
#   esphome_config:
  # ha_config:
  # homer_data:
  # syncthing_config:
networks:
  proxy:
    external: false
